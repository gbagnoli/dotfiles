#!/bin/bash

if command -v brew >/dev/null; then
  echo >&2 "* brew update"
  brew update
  echo >&2 "* brew upgrade"
  brew upgrade
  echo >&2 "* brew cleanup"
  brew cleanup
  # update also uv tools
  if command -v uv &>/dev/null; then
    echo >&2 "* uv tool upgrade --all"
    uv tool upgrade --all
  fi

  if [ -L "$0" ]; then
    dotfiles="$(realpath "$(dirname "$(readlink -f "$0")")")"
    if [ -f "$dotfiles/Brewfile" ]; then
      echo >&2 "* Installing/upgrade brew bundle from ${dotfiles}/Brewfile"
      brew bundle upgrade --file "${dotfiles}/Brewfile"
    fi
  fi
fi
